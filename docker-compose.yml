version: '3'
services:
  server:
    build: server/
    command: python3 ./server.py
    volumes:
      - ./server:/server
    depends_on:
      - database
    environment:
      MAX_CLIENTS: 5
      WORKERS_NUMBER: 2
      DISPATCHERS_NUMBER: 2
    networks:
      net:
        ipv4_address: 172.28.1.1

  ftp_server:
    image: delfer/alpine-ftp-server
    ports:
      - '21:21'
      - '21000-21010:21000-21010'
    volumes:
      - ./ftp_server/ftp:/ftp/ftp
    environment:
      ADDRESS: '172.28.1.3'
      USERS: 'username|mypass'
    networks:
      - net

  database:
    build: database/
    command: python3 ./database.py
    volumes:
      - ./database:/database
    environment:
      MAX_DISPATCHERS: 3
      MAX_WORKERS: 3
      RESOLVERS_NUMBER: 3
      PERSISTORS_NUMBER: 3
    networks:
      net:
        ipv4_address: 172.28.1.4

  client:
    build: client/
    command: python3 ./client.py -r 172.28.1.3 -p /dev
    volumes:
      - ./client:/client
    depends_on:
      - server
    networks:
      - net

networks:
  net:
    ipam:
      driver: default
      config:
        - subnet: 172.28.0.0/16
